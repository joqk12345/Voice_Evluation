<!--pages/history/history.wxml - ä¸“ä¸šéŸ³é¢‘åˆ†æé£æ ¼-->

<view class="history-container">
  <!-- æ•°æ®å›¾è¡¨è£…é¥° -->
  <view class="data-chart-decoration">
    <view class="chart-bar"></view>
    <view class="chart-bar"></view>
    <view class="chart-bar"></view>
    <view class="chart-bar"></view>
    <view class="chart-bar"></view>
    <view class="chart-bar"></view>
  </view>

  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">è¯„æµ‹è®°å½•</text>
    <text class="page-subtitle">å…±{{historyList.length}}æ¡è®°å½•</text>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="stats-overview">
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{totalRecords}}</text>
        <text class="stat-label">æ€»è¯„æµ‹æ¬¡æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{averageScore}}</text>
        <text class="stat-label">å¹³å‡åˆ†æ•°</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å™¨ -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" bindtap="switchFilter" data-filter="all">
        å…¨éƒ¨
      </view>
      <view class="filter-tab {{currentFilter === 'recent' ? 'active' : ''}}" bindtap="switchFilter" data-filter="recent">
        æœ€è¿‘
      </view>
      <view class="filter-tab {{currentFilter === 'high' ? 'active' : ''}}" bindtap="switchFilter" data-filter="high">
        é«˜åˆ†
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view class="history-section">
    <view class="history-list" wx:if="{{historyList.length > 0}}">
      <view class="history-item" wx:for="{{historyList}}" wx:key="id">
        <!-- è®°å½•å¤´éƒ¨ -->
        <view class="record-header">
          <view class="record-info">
            <view class="record-title">
              <text class="song-name">{{item.song}}</text>
              <text class="record-date">{{item.date}}</text>
            </view>
            <view class="record-score">
              <text class="score-number">{{item.overallScore}}</text>
              <text class="score-label">åˆ†</text>
            </view>
          </view>
        </view>

        <!-- è¯¦ç»†æŒ‡æ ‡ -->
        <view class="metrics-grid">
          <view class="metric-item">
            <text class="metric-label">éŸ³å‡†</text>
            <text class="metric-value">{{item.pitch}}</text>
          </view>
          <view class="metric-item">
            <text class="metric-label">èŠ‚å¥</text>
            <text class="metric-value">{{item.rhythm}}</text>
          </view>
          <view class="metric-item">
            <text class="metric-label">éŸ³é‡</text>
            <text class="metric-value">{{item.volume}}</text>
          </view>
          <view class="metric-item">
            <text class="metric-label">éŸ³è‰²</text>
            <text class="metric-value">{{item.timbre}}</text>
          </view>
        </view>

        <!-- è®°å½•åº•éƒ¨ -->
        <view class="record-footer">
          <view class="record-meta">
            <text class="duration">æ—¶é•¿: {{item.duration}}</text>
          </view>
          <view class="record-actions">
            <view class="action-control" bindtap="shareRecord" data-id="{{item.id}}">
              <view class="control-dots">â‹¯</view>
              <view class="control-record">â—</view>
            </view>
            <view class="action-control danger" bindtap="deleteRecord" data-id="{{item.id}}">
              <view class="control-dots">â‹¯</view>
              <view class="control-record">â—</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">ğŸ“Š</view>
      <text class="empty-title">æš‚æ— è¯„æµ‹è®°å½•</text>
      <text class="empty-desc">å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡å£°ä¹è¯„æµ‹å§</text>
      <button class="empty-action" bindtap="goToRecord">å¼€å§‹è¯„æµ‹</button>
    </view>
  </view>

  <!-- è¿›æ­¥è¶‹åŠ¿ -->
  <view class="progress-section" wx:if="{{historyList.length > 1}}">
    <view class="progress-card">
      <view class="progress-header">
        <text class="progress-title">è¿›æ­¥è¶‹åŠ¿</text>
        <text class="progress-subtitle">åˆ†æ•°æ—¶é—´</text>
      </view>
      
      <view class="progress-chart">
        <view class="chart-container">
          <view class="chart-bar" wx:for="{{trendData}}" wx:key="index" style="height: {{item.height}}rpx;">
            <view class="bar-value">{{item.score}}</view>
          </view>
        </view>
        <view class="chart-labels">
          <text class="chart-label" wx:for="{{trendData}}" wx:key="index">{{item.date}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†é¡µ -->
  <view class="pagination" wx:if="{{totalPages > 1}}">
    <view class="page-btn {{currentPage === 1 ? 'disabled' : ''}}" bindtap="prevPage">
      <text>â€¹</text>
    </view>
    <view class="page-btn active">{{currentPage}}</view>
    <view class="page-btn {{currentPage === totalPages ? 'disabled' : ''}}" bindtap="nextPage">
      <text>â€º</text>
    </view>
  </view>
</view>