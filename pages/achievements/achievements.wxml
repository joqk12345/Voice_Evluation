<!--æˆå°±å¾½ç« é¡µé¢-->
<view class="achievements-container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="achievements-decoration">
    <view class="decoration-star star-1">â­</view>
    <view class="decoration-star star-2">ğŸŒŸ</view>
    <view class="decoration-star star-3">âœ¨</view>
    <view class="decoration-star star-4">ğŸ’«</view>
    <view class="decoration-star star-5">â­</view>
    <view class="decoration-line line-1"></view>
    <view class="decoration-line line-2"></view>
  </view>

  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="achievements-header">
    <view class="header-content">
      <view class="header-title">
        <text class="title-text">æˆå°±å¾½ç« </text>
        <text class="title-subtitle">è®°å½•ä½ çš„å£°ä¹æˆé•¿ä¹‹è·¯</text>
      </view>
      <view class="header-stats">
        <view class="stat-item">
          <text class="stat-number">{{userStats.unlockedCount}}</text>
          <text class="stat-label">å·²è§£é”</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{userStats.totalCount}}</text>
          <text class="stat-label">æ€»å¾½ç« </text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{userStats.completionRate}}%</text>
          <text class="stat-label">å®Œæˆåº¦</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="category-tabs">
    <view class="tab-item {{currentCategory === 'all' ? 'active' : ''}}" 
          bindtap="switchCategory" data-category="all">
      <text class="tab-text">å…¨éƒ¨</text>
    </view>
    <view class="tab-item {{currentCategory === 'skill' ? 'active' : ''}}" 
          bindtap="switchCategory" data-category="skill">
      <text class="tab-text">æŠ€èƒ½ç±»</text>
    </view>
    <view class="tab-item {{currentCategory === 'challenge' ? 'active' : ''}}" 
          bindtap="switchCategory" data-category="challenge">
      <text class="tab-text">æŒ‘æˆ˜ç±»</text>
    </view>
    <view class="tab-item {{currentCategory === 'social' ? 'active' : ''}}" 
          bindtap="switchCategory" data-category="social">
      <text class="tab-text">ç¤¾äº¤ç±»</text>
    </view>
  </view>

  <!-- æˆå°±å¾½ç« ç½‘æ ¼ -->
  <view class="achievements-grid">
    <view class="achievement-card {{item.unlocked ? 'unlocked' : 'locked'}} {{item.rare ? 'rare' : ''}}" 
          wx:for="{{filteredAchievements}}" wx:key="id" bindtap="viewAchievementDetail" data-achievement="{{item}}">
      
      <!-- å¾½ç« å›¾æ ‡ -->
      <view class="badge-container">
        <view class="badge-icon {{item.unlocked ? 'unlocked' : 'locked'}}">
          <text class="badge-emoji">{{item.emoji}}</text>
          <view class="badge-glow" wx:if="{{item.unlocked}}"></view>
        </view>
        <view class="badge-level" wx:if="{{item.level}}">
          <text class="level-text">{{item.level}}</text>
        </view>
      </view>

      <!-- å¾½ç« ä¿¡æ¯ -->
      <view class="badge-info">
        <text class="badge-name">{{item.name}}</text>
        <text class="badge-desc">{{item.description}}</text>
        <view class="badge-category">
          <text class="category-tag">{{item.categoryName}}</text>
        </view>
      </view>

      <!-- è¿›åº¦æ¡ -->
      <view class="badge-progress" wx:if="{{!item.unlocked}}">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{item.progress}}%;"></view>
        </view>
        <text class="progress-text">{{item.current}}/{{item.target}}</text>
      </view>

      <!-- è§£é”çŠ¶æ€ -->
      <view class="badge-status">
        <text class="status-text" wx:if="{{item.unlocked}}">å·²è§£é”</text>
        <text class="status-text locked" wx:else>æœªè§£é”</text>
      </view>

      <!-- ç¨€æœ‰åº¦æ ‡è¯† -->
      <view class="rarity-indicator" wx:if="{{item.rare}}">
        <text class="rarity-text">ç¨€æœ‰</text>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘è§£é”çš„æˆå°± -->
  <view class="recent-unlocks" wx:if="{{recentUnlocks.length > 0}}">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘è§£é”</text>
      <text class="section-more" bindtap="viewAllUnlocks">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    <view class="unlocks-list">
      <view class="unlock-item" wx:for="{{recentUnlocks}}" wx:key="id">
        <view class="unlock-icon">
          <text class="unlock-emoji">{{item.emoji}}</text>
        </view>
        <view class="unlock-info">
          <text class="unlock-name">{{item.name}}</text>
          <text class="unlock-time">{{item.unlockTime}}</text>
        </view>
        <view class="unlock-reward">
          <text class="reward-text">+{{item.reward}}åˆ†</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆå°±ç»Ÿè®¡ -->
  <view class="achievement-stats">
    <view class="section-header">
      <text class="section-title">æˆå°±ç»Ÿè®¡</text>
    </view>
    <view class="stats-grid">
      <view class="stat-card">
        <view class="stat-icon">ğŸ¯</view>
        <text class="stat-title">æŠ€èƒ½ç±»</text>
        <text class="stat-value">{{categoryStats.skill.unlocked}}/{{categoryStats.skill.total}}</text>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ†</view>
        <text class="stat-title">æŒ‘æˆ˜ç±»</text>
        <text class="stat-value">{{categoryStats.challenge.unlocked}}/{{categoryStats.challenge.total}}</text>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ‘¥</view>
        <text class="stat-title">ç¤¾äº¤ç±»</text>
        <text class="stat-value">{{categoryStats.social.unlocked}}/{{categoryStats.social.total}}</text>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ’</view>
        <text class="stat-title">ç¨€æœ‰å¾½ç« </text>
        <text class="stat-value">{{categoryStats.rare.unlocked}}/{{categoryStats.rare.total}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="achievements-actions">
    <view class="action-btn primary" bindtap="shareAchievements">
      <text class="btn-icon">ğŸ“¤</text>
      <text class="btn-text">åˆ†äº«æˆå°±</text>
    </view>
    <view class="action-btn secondary" bindtap="viewLeaderboard">
      <text class="btn-icon">ğŸ†</text>
      <text class="btn-text">æ’è¡Œæ¦œ</text>
    </view>
  </view>
</view>

<!-- æˆå°±è¯¦æƒ…å¼¹çª— -->
<view class="achievement-modal {{showModal ? 'show' : ''}}" bindtap="closeModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-badge">
        <view class="modal-icon {{selectedAchievement.unlocked ? 'unlocked' : 'locked'}}">
          <text class="modal-emoji">{{selectedAchievement.emoji}}</text>
        </view>
        <view class="modal-level" wx:if="{{selectedAchievement.level}}">
          <text class="modal-level-text">{{selectedAchievement.level}}</text>
        </view>
      </view>
      <text class="modal-close" bindtap="closeModal">Ã—</text>
    </view>
    
    <view class="modal-body">
      <view class="modal-title">
        <text class="title-text">{{selectedAchievement.name}}</text>
        <text class="title-desc">{{selectedAchievement.description}}</text>
      </view>
      
      <view class="modal-details">
        <view class="detail-item">
          <text class="detail-label">åˆ†ç±»ï¼š</text>
          <text class="detail-value">{{selectedAchievement.categoryName}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">ç¨€æœ‰åº¦ï¼š</text>
          <text class="detail-value">{{selectedAchievement.rare ? 'ç¨€æœ‰' : 'æ™®é€š'}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å¥–åŠ±ï¼š</text>
          <text class="detail-value">+{{selectedAchievement.reward}}åˆ†</text>
        </view>
        <view class="detail-item" wx:if="{{selectedAchievement.unlockTime}}">
          <text class="detail-label">è§£é”æ—¶é—´ï¼š</text>
          <text class="detail-value">{{selectedAchievement.unlockTime}}</text>
        </view>
      </view>

      <view class="modal-progress" wx:if="{{!selectedAchievement.unlocked}}">
        <text class="progress-title">è§£é”è¿›åº¦</text>
        <view class="progress-container">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{selectedAchievement.progress}}%;"></view>
          </view>
          <text class="progress-text">{{selectedAchievement.current}}/{{selectedAchievement.target}}</text>
        </view>
        <text class="progress-desc">{{selectedAchievement.unlockCondition}}</text>
      </view>

      <view class="modal-tips" wx:if="{{selectedAchievement.tips}}">
        <text class="tips-title">è§£é”æç¤º</text>
        <text class="tips-content">{{selectedAchievement.tips}}</text>
      </view>
    </view>
    
    <view class="modal-actions">
      <view class="modal-btn cancel" bindtap="closeModal">å…³é—­</view>
      <view class="modal-btn confirm" bindtap="shareAchievement" wx:if="{{selectedAchievement.unlocked}}">åˆ†äº«</view>
    </view>
  </view>
</view>

<!-- æˆå°±è§£é”é€šçŸ¥ -->
<view class="unlock-notification {{showNotification ? 'show' : ''}}" wx:if="{{newUnlock}}">
  <view class="notification-content">
    <view class="notification-icon">
      <text class="notification-emoji">{{newUnlock.emoji}}</text>
    </view>
    <view class="notification-info">
      <text class="notification-title">ğŸ‰ æˆå°±è§£é”ï¼</text>
      <text class="notification-name">{{newUnlock.name}}</text>
      <text class="notification-reward">+{{newUnlock.reward}}åˆ†</text>
    </view>
    <view class="notification-close" bindtap="closeNotification">Ã—</view>
  </view>
</view>