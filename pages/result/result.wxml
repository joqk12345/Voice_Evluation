<!--pages/result/result.wxml - ä¸“ä¸šç®€æ´é£æ ¼ï¼Œå‚è€ƒ tobiplayer renderer-->
<view class="result-container">
  <!-- ç®€æ´æ ‡é¢˜æ  -->
  <view class="page-header">
    <view class="header-content">
      <text class="page-title">éŸ³é¢‘åˆ†æç»“æœ</text>
      <text class="page-date">{{currentDate}}</text>
    </view>
  </view>

  <!-- éäººå£°æç¤ºï¼ˆä»…å½“äººå£°æ£€æµ‹å¯ç”¨ä¸”æ£€æµ‹åˆ°éäººå£°æ—¶æ˜¾ç¤ºï¼‰ -->
  <view class="voice-warning" wx:if="{{!isVoice && voiceReason && voiceReason.indexOf('å·²ç¦ç”¨') === -1}}">
    <view class="warning-content">
      <text class="warning-icon">âš ï¸</text>
      <view class="warning-text">
        <text class="warning-title">æœªæ£€æµ‹åˆ°äººå£°</text>
        <text class="warning-desc">{{voiceReason || 'è¯·ç¡®ä¿å½•åˆ¶çš„æ˜¯æ‚¨çš„æ­Œå£°'}}</text>
      </view>
    </view>
  </view>

  <!-- æ—¶é•¿æç¤º -->
  <view class="voice-warning" wx:if="{{durationCheck && durationCheck.penalty > 0}}">
    <view class="warning-content">
      <text class="warning-icon">ğŸ“</text>
      <view class="warning-text">
        <text class="warning-title">å½•éŸ³æ—¶é•¿ä¸åˆé€‚</text>
        <text class="warning-desc">{{durationCheck.reason}}</text>
      </view>
    </view>
  </view>

  <!-- æ—‹å¾‹æç¤ºï¼ˆä»…å½“æ—‹å¾‹æ£€æµ‹å¯ç”¨ä¸”æ£€æµ‹åˆ°æ— æ—‹å¾‹æ—¶æ˜¾ç¤ºï¼‰ -->
  <view class="voice-warning" wx:if="{{melodyCheck && !melodyCheck.hasMelody && melodyCheck.reason && melodyCheck.reason.indexOf('å·²ç¦ç”¨') === -1}}">
    <view class="warning-content">
      <text class="warning-icon">ğŸµ</text>
      <view class="warning-text">
        <text class="warning-title">æ—‹å¾‹ä¸æ˜æ˜¾</text>
        <text class="warning-desc">{{melodyCheck.reason}}</text>
      </view>
    </view>
  </view>

  <!-- æ³¢å½¢å’ŒéŸ³é«˜å±•ç¤ºï¼ˆä¸“ä¸šå¯è§†åŒ–ï¼‰ -->
  <view class="waveform-section" wx:if="{{hasWaveform}}">
    <view class="section-header">
      <text class="section-title">æ³¢å½¢ä¸éŸ³é«˜åˆ†æ</text>
      <text class="section-subtitle">Waveform & Pitch Analysis</text>
    </view>
    <view class="waveform-wrapper">
      <canvas 
        canvas-id="resultWaveformCanvas" 
        id="resultWaveformCanvas"
        class="waveform-canvas"
        style="width: 100%; height: 500rpx;"
      ></canvas>
    </view>
    </view>
    
  <!-- æ€»åˆ†å±•ç¤ºï¼ˆç®€æ´å¡ç‰‡ï¼‰ -->
  <view class="score-section">
    <view class="score-card">
      <view class="score-main">
        <text class="score-number">{{resultData.score}}</text>
        <text class="score-unit">åˆ†</text>
      </view>
      <view class="score-info">
        <text class="level-badge">{{scoreLevel.level}}</text>
        <text class="level-desc">{{getLevelDescription(resultData.score)}}</text>
      </view>
    </view>
  </view>

  <!-- è¯¦ç»†æŒ‡æ ‡ -->
  <view class="metrics-section">
    <view class="section-title">è¯¦ç»†åˆ†æ</view>
    <view class="metrics-grid">
      <view class="metric-card" wx:for="{{metricsList}}" wx:key="index">
        <view class="metric-header">
          <text class="metric-icon">{{item.icon}}</text>
            <text class="metric-name">{{item.name}}</text>
          </view>
          <view class="metric-score">
            <text class="score-value">{{item.score}}</text>
            <text class="score-unit">åˆ†</text>
          </view>
        <view class="metric-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.score}}%;"></view>
          </view>
        </view>
        <view class="metric-advice">
          <text class="advice-text">{{item.advice}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ”¹è¿›å»ºè®® -->
  <view class="advice-section">
    <view class="section-title">æ”¹è¿›å»ºè®®</view>
    <view class="advice-list">
      <view class="advice-item" wx:for="{{adviceList}}" wx:key="index">
        <text class="advice-icon">ğŸ’¡</text>
        <text class="advice-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-section">
    <button 
      class="action-btn secondary" 
      bindtap="playRecord" 
      wx:if="{{recordFilePath}}"
    >
      <text class="btn-icon">{{isPlaying ? 'â¸ï¸' : 'â–¶ï¸'}}</text>
      <text class="btn-text">{{isPlaying ? 'æš‚åœæ’­æ”¾' : 'æ’­æ”¾å½•éŸ³'}}</text>
    </button>
    
    <button class="action-btn primary" bindtap="viewRecommend">
      <text class="btn-icon">ğŸµ</text>
      <text class="btn-text">æŸ¥çœ‹æ¨è</text>
    </button>
    
    <button class="action-btn share-btn" bindtap="generateShareImage">
      <text class="btn-icon">ğŸ“¤</text>
      <text class="btn-text">ç”Ÿæˆåˆ†äº«å›¾ç‰‡</text>
    </button>
  </view>

  <!-- éšè—çš„Canvasç”¨äºç”Ÿæˆå›¾ç‰‡ -->
  <canvas 
    canvas-id="shareCanvas" 
    id="shareCanvas"
    class="share-canvas"
  ></canvas>
</view>
