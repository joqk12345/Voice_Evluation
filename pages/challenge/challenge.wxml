<!--æ¯æ—¥æŒ‘æˆ˜é¡µé¢-->
<view class="challenge-container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="challenge-decoration">
    <view class="decoration-circle circle-1"></view>
    <view class="decoration-circle circle-2"></view>
    <view class="decoration-circle circle-3"></view>
    <view class="decoration-line line-1"></view>
    <view class="decoration-line line-2"></view>
  </view>

  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="challenge-header">
    <view class="header-content">
      <view class="header-title">
        <text class="title-text">æ¯æ—¥æŒ‘æˆ˜</text>
        <text class="title-subtitle">ä¸“ä¸šå£°ä¹è®­ç»ƒ</text>
      </view>
      <view class="header-stats">
        <view class="stat-item">
          <text class="stat-number">{{userStats.continuousDays}}</text>
          <text class="stat-label">è¿ç»­å¤©æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{userStats.totalChallenges}}</text>
          <text class="stat-label">å®ŒæˆæŒ‘æˆ˜</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æŒ‘æˆ˜å¡ç‰‡ -->
  <view class="today-challenge-card">
    <view class="card-header">
      <view class="header-left">
        <text class="card-title">ä»Šæ—¥æŒ‘æˆ˜</text>
        <text class="card-date">{{todayDate}}</text>
      </view>
      <view class="header-right">
        <view class="progress-ring">
          <view class="ring-bg"></view>
          <view class="ring-progress" style="transform: rotate({{progressAngle}}deg);"></view>
          <view class="ring-text">
            <text class="progress-number">{{todayProgress}}/{{todayTotal}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æŒ‘æˆ˜ä»»åŠ¡åˆ—è¡¨ -->
    <view class="challenge-tasks">
      <view class="task-item" wx:for="{{todayChallenges}}" wx:key="id" bindtap="startChallenge" data-task="{{item}}">
        <view class="task-icon {{item.completed ? 'completed' : ''}}">
          <text class="icon-text">{{item.completed ? 'âœ“' : item.icon}}</text>
        </view>
        <view class="task-content">
          <view class="task-header">
            <text class="task-title">{{item.title}}</text>
            <view class="task-reward">
              <text class="reward-text">+{{item.reward}}åˆ†</text>
            </view>
          </view>
          <text class="task-desc">{{item.description}}</text>
          <view class="task-progress">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.progress}}%;"></view>
            </view>
            <text class="progress-text">{{item.current}}/{{item.target}}</text>
          </view>
        </view>
        <view class="task-action">
          <text class="action-text">{{item.completed ? 'å·²å®Œæˆ' : 'å¼€å§‹'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æŒ‘æˆ˜æˆå°± -->
  <view class="achievements-section">
    <view class="section-header">
      <text class="section-title">æŒ‘æˆ˜æˆå°±</text>
      <text class="section-more" bindtap="viewAllAchievements">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    <view class="achievements-grid">
      <view class="achievement-item" wx:for="{{recentAchievements}}" wx:key="id">
        <view class="achievement-icon {{item.unlocked ? 'unlocked' : 'locked'}}">
          <text class="achievement-emoji">{{item.emoji}}</text>
        </view>
        <text class="achievement-name">{{item.name}}</text>
        <text class="achievement-desc">{{item.description}}</text>
      </view>
    </view>
  </view>

  <!-- æ’è¡Œæ¦œ -->
  <view class="leaderboard-section">
    <view class="section-header">
      <text class="section-title">æœ¬å‘¨æ’è¡Œ</text>
      <text class="section-more" bindtap="viewLeaderboard">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    <view class="leaderboard-list">
      <view class="leaderboard-item" wx:for="{{leaderboard}}" wx:key="rank">
        <view class="rank-badge rank-{{item.rank}}">
          <text class="rank-number">{{item.rank}}</text>
        </view>
        <view class="user-info">
          <image class="user-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <view class="user-details">
            <text class="user-name">{{item.name}}</text>
            <text class="user-score">{{item.score}}åˆ†</text>
          </view>
        </view>
        <view class="user-stats">
          <text class="stats-text">{{item.challenges}}ä¸ªæŒ‘æˆ˜</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æŒ‘æˆ˜å†å² -->
  <view class="history-section">
    <view class="section-header">
      <text class="section-title">æŒ‘æˆ˜å†å²</text>
      <text class="section-more" bindtap="viewHistory">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    <view class="history-calendar">
      <view class="calendar-header">
        <text class="calendar-title">{{currentMonth}}</text>
        <view class="calendar-nav">
          <text class="nav-btn" bindtap="prevMonth">â€¹</text>
          <text class="nav-btn" bindtap="nextMonth">â€º</text>
        </view>
      </view>
      <view class="calendar-grid">
        <view class="calendar-day {{item.hasChallenge ? 'has-challenge' : ''}} {{item.completed ? 'completed' : ''}}" 
              wx:for="{{calendarDays}}" wx:key="date" bindtap="viewDayDetail" data-date="{{item.date}}">
          <text class="day-number">{{item.day}}</text>
          <view class="day-status" wx:if="{{item.hasChallenge}}">
            <text class="status-dot {{item.completed ? 'completed' : 'pending'}}"></text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="challenge-actions">
    <view class="action-btn primary" bindtap="startTodayChallenge">
      <text class="btn-icon">ğŸ¯</text>
      <text class="btn-text">å¼€å§‹ä»Šæ—¥æŒ‘æˆ˜</text>
    </view>
    <view class="action-btn secondary" bindtap="viewRecommendations">
      <text class="btn-icon">ğŸ’¡</text>
      <text class="btn-text">è·å–å»ºè®®</text>
    </view>
  </view>
</view>

<!-- æŒ‘æˆ˜è¯¦æƒ…å¼¹çª— -->
<view class="challenge-modal {{showModal ? 'show' : ''}}" bindtap="closeModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">{{selectedTask.title}}</text>
      <text class="modal-close" bindtap="closeModal">Ã—</text>
    </view>
    <view class="modal-body">
      <text class="modal-desc">{{selectedTask.description}}</text>
      <view class="modal-reward">
        <text class="reward-label">å¥–åŠ±ï¼š</text>
        <text class="reward-value">+{{selectedTask.reward}}åˆ†</text>
      </view>
      <view class="modal-tips">
        <text class="tips-title">æŒ‘æˆ˜æç¤ºï¼š</text>
        <text class="tips-content">{{selectedTask.tips}}</text>
      </view>
    </view>
    <view class="modal-actions">
      <view class="modal-btn cancel" bindtap="closeModal">å–æ¶ˆ</view>
      <view class="modal-btn confirm" bindtap="confirmChallenge">å¼€å§‹æŒ‘æˆ˜</view>
    </view>
  </view>
</view>

