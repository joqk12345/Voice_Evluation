<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="å£°ä¹è¯„æµ‹ç»“æœ - æŸ¥çœ‹æ‚¨çš„å£°ä¹è¯„æµ‹è¯¦ç»†æŠ¥å‘Š">
  <title>å£°ä¹è¯„æµ‹ç»“æœ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #6b46c1 0%, #9333ea 30%, #f97316 70%, #fbbf24 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 750px;
      margin: 0 auto;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #6b46c1 0%, #9333ea 50%, #f97316 100%);
      padding: 40px 20px;
      text-align: center;
      color: #fff;
    }

    .header h1 {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .header .emoji {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .header .date {
      font-size: 16px;
      opacity: 0.9;
    }

    .score-section {
      padding: 40px 20px;
      text-align: center;
      background: #fff;
    }

    .score-circle {
      width: 200px;
      height: 200px;
      margin: 0 auto 30px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .score-ring {
      width: 100%;
      height: 100%;
      position: absolute;
    }

    .score-progress {
      width: 100%;
      height: 100%;
      position: absolute;
    }

    .score-text {
      position: relative;
      z-index: 1;
    }

    .score-number {
      font-size: 72px;
      font-weight: bold;
      color: #333;
      line-height: 1;
    }

    .score-unit {
      font-size: 24px;
      color: #666;
      margin-top: 5px;
    }

    .level-badge {
      display: inline-block;
      padding: 8px 20px;
      background: rgba(255, 154, 86, 0.25);
      border-radius: 20px;
      font-size: 18px;
      color: #333;
      margin-bottom: 20px;
    }

    .message {
      font-size: 18px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 20px;
      padding: 0 20px;
    }

    .comparison {
      font-size: 16px;
      color: #999;
      margin-bottom: 30px;
    }

    .metrics-section {
      padding: 30px 20px;
      background: #f8f9fa;
    }

    .metrics-title {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }

    .metric-item {
      margin-bottom: 25px;
    }

    .metric-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .metric-name {
      font-size: 18px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .metric-score {
      font-size: 20px;
      font-weight: bold;
      color: #ff9a56;
    }

    .metric-bar {
      height: 12px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 6px;
      overflow: hidden;
      position: relative;
    }

    .metric-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff9a56 0%, #ffad70 50%, #ffd700 100%);
      border-radius: 6px;
      transition: width 1s ease;
      width: 0;
    }

    .advice-section {
      padding: 30px 20px;
      background: #fff;
    }

    .advice-title {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }

    .advice-list {
      list-style: none;
    }

    .advice-item {
      padding: 15px;
      margin-bottom: 10px;
      background: #f8f9fa;
      border-radius: 10px;
      border-left: 4px solid #ff9a56;
      font-size: 16px;
      line-height: 1.6;
      color: #666;
    }

    .achievements-section {
      padding: 30px 20px;
      background: #f8f9fa;
      text-align: center;
    }

    .achievements-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #333;
    }

    .achievements-list {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .achievement-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .achievement-icon {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255, 154, 86, 0.22);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
    }

    .achievement-name {
      font-size: 14px;
      color: #666;
    }

    .footer {
      padding: 30px 20px;
      text-align: center;
      background: #fff;
      border-top: 1px solid #eee;
    }

    .footer-text {
      font-size: 14px;
      color: #999;
      margin-bottom: 20px;
    }

    .qrcode-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .qrcode-placeholder {
      width: 150px;
      height: 150px;
      background: #f0f0f0;
      border: 2px solid #ddd;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #999;
    }

    .share-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .share-btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, #ff9a56 0%, #ffd700 100%);
      color: #fff;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .share-btn:hover {
      transform: scale(1.05);
    }

    .share-btn:active {
      transform: scale(0.95);
    }

    .loading {
      text-align: center;
      padding: 100px 20px;
      color: #999;
    }

    .error {
      text-align: center;
      padding: 100px 20px;
      color: #f44336;
    }

    @media (max-width: 480px) {
      .header h1 {
        font-size: 24px;
      }

      .score-circle {
        width: 150px;
        height: 150px;
      }

      .score-number {
        font-size: 54px;
      }

      .metric-name {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <div class="loading" id="loading">åŠ è½½ä¸­...</div>
    <div id="content" style="display: none;">
      <!-- Header -->
      <div class="header">
        <div class="emoji">ğŸ¶</div>
        <h1>ä»Šæ—¥å£°éŸ³æŠ¥å‘Š</h1>
        <div class="date" id="date"></div>
      </div>

      <!-- Score Section -->
      <div class="score-section">
        <div class="score-circle">
          <svg class="score-ring" viewBox="0 0 200 200">
            <circle cx="100" cy="100" r="82" fill="none" stroke="rgba(255, 255, 255, 0.2)" stroke-width="18"/>
            <circle cx="100" cy="100" r="82" fill="none" stroke="url(#gradient)" stroke-width="18" 
                    stroke-dasharray="515" stroke-dashoffset="515" stroke-linecap="round"
                    id="scoreProgressCircle" transform="rotate(-90 100 100)"/>
            <defs>
              <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#ff9a56;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#ffad70;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#ffd700;stop-opacity:1" />
              </linearGradient>
            </defs>
          </svg>
          <div class="score-text">
            <div class="score-number" id="scoreNumber">0</div>
            <div class="score-unit">åˆ†</div>
          </div>
        </div>
        <div class="level-badge" id="levelBadge">åˆçº§</div>
        <div class="message" id="message"></div>
        <div class="comparison" id="comparison"></div>
      </div>

      <!-- Metrics Section -->
      <div class="metrics-section">
        <div class="metrics-title">è¯¦ç»†æŒ‡æ ‡</div>
        <div id="metricsList"></div>
      </div>

      <!-- Achievements Section -->
      <div class="achievements-section" id="achievementsSection" style="display: none;">
        <div class="achievements-title">æˆå°±å¾½ç« </div>
        <div class="achievements-list" id="achievementsList"></div>
      </div>

      <!-- Advice Section -->
      <div class="advice-section">
        <div class="advice-title">æ”¹è¿›å»ºè®®</div>
        <ul class="advice-list" id="adviceList"></ul>
      </div>

      <!-- Footer -->
      <div class="footer">
        <div class="footer-text">æ‰«ç ä½“éªŒå£°ä¹è¯„æµ‹å°ç¨‹åº</div>
        <div class="qrcode-section">
          <div class="qrcode-placeholder">å°ç¨‹åºç </div>
        </div>
        <div class="share-buttons">
          <button class="share-btn" onclick="copyLink()">å¤åˆ¶é“¾æ¥</button>
          <button class="share-btn" onclick="shareToWechat()">åˆ†äº«åˆ°å¾®ä¿¡</button>
        </div>
      </div>
    </div>
    <div class="error" id="error" style="display: none;">åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦æ­£ç¡®</div>
  </div>

  <script>
    // è·å–URLå‚æ•°
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      const data = params.get('data');
      if (data) {
        try {
          return JSON.parse(decodeURIComponent(data));
        } catch (e) {
          console.error('è§£ææ•°æ®å¤±è´¥:', e);
          return null;
        }
      }
      return null;
    }

    // è·å–åˆ†æ•°ç­‰çº§
    function getScoreLevel(score) {
      if (score >= 90) return 'ä¼˜ç§€';
      if (score >= 80) return 'è‰¯å¥½';
      if (score >= 70) return 'ä¸­ç­‰';
      if (score >= 60) return 'åŠæ ¼';
      return 'åˆçº§';
    }

    // è·å–ä¸ªæ€§åŒ–æ–‡æ¡ˆ
    function getPersonalizedMessage(score) {
      if (score < 70) {
        const messages = [
          'æ¯ä¸€æ¬¡å‘å£°éƒ½æ˜¯è¿›æ­¥çš„å¼€å§‹ âœ¨',
          'ä½ çš„å£°éŸ³æœ‰æ— é™å¯èƒ½ï¼Œç»§ç»­åŠ æ²¹ ğŸ’ª',
          'åšæŒç»ƒä¹ ï¼Œå£°éŸ³ä¼šè¶Šæ¥è¶Šç¾ ğŸŒ±'
        ];
        return messages[Math.floor(Math.random() * messages.length)];
      } else if (score >= 70 && score < 85) {
        const messages = [
          'ä½ çš„å£°éŸ³æ¸©æŸ”è€Œæœ‰åŠ›é‡ ğŸ’«',
          'è¡¨ç°ä¸é”™ï¼Œç»§ç»­åŠªåŠ›ä¼šæ›´å¥½',
          'ä½ çš„å£°éŸ³å¾ˆæœ‰æ½œåŠ›ï¼ŒåŠ æ²¹ï¼'
        ];
        return messages[Math.floor(Math.random() * messages.length)];
      } else {
        const messages = [
          'ä½ çš„å£°éŸ³å¦‚å¤©ç±ä¹‹éŸ³ ğŸµ',
          'å®Œç¾çš„è¡¨ç°ï¼Œä½ å°±æ˜¯å£°éŸ³ä¹‹æ˜Ÿï¼',
          'ä½ çš„å£°éŸ³å¾æœäº†æ‰€æœ‰äºº âœ¨'
        ];
        return messages[Math.floor(Math.random() * messages.length)];
      }
    }

    // è®¡ç®—è¶…è¿‡çš„ç”¨æˆ·ç™¾åˆ†æ¯”
    function calculateComparison(score) {
      let percent = 0;
      if (score >= 90) {
        percent = 95 + Math.random() * 5;
      } else if (score >= 85) {
        percent = 85 + Math.random() * 10;
      } else if (score >= 80) {
        percent = 70 + Math.random() * 15;
      } else if (score >= 75) {
        percent = 55 + Math.random() * 15;
      } else if (score >= 70) {
        percent = 40 + Math.random() * 15;
      } else if (score >= 65) {
        percent = 25 + Math.random() * 15;
      } else {
        percent = 10 + Math.random() * 15;
      }
      return Math.round(percent);
    }

    // ç”Ÿæˆæˆå°±å¾½ç« 
    function generateAchievements(data) {
      const achievements = [];
      const score = data.score || 0;
      const pitch = data.pitch || 0;
      const rhythm = data.rhythm || 0;
      const volume = data.volume || 0;
      const timbre = data.timbre || 0;

      if (rhythm >= 85) {
        achievements.push({ icon: 'ğŸ¼', name: 'èŠ‚å¥è¾¾äºº' });
      }
      if (score >= 90) {
        achievements.push({ icon: 'âœ¨', name: 'å£°éŸ³ä¹‹å…‰' });
      }
      if (pitch >= 88) {
        achievements.push({ icon: 'ğŸµ', name: 'éŸ³å‡†å¤§å¸ˆ' });
      }
      if (score >= 60 && achievements.length === 0) {
        achievements.push({ icon: 'ğŸŒŸ', name: 'å‹‡æ•¢å°è¯•' });
      }

      return achievements.slice(0, 2);
    }

    // è·å–æ”¹è¿›å»ºè®®
    function getAdvice(data) {
      const advice = [];
      const pitch = data.pitch || 0;
      const rhythm = data.rhythm || 0;
      const volume = data.volume || 0;
      const timbre = data.timbre || 0;

      if (pitch < 80) {
        advice.push('å¤šç»ƒä¹ éŸ³é˜¶ï¼Œæé«˜éŸ³å‡†å‡†ç¡®æ€§');
      }
      if (rhythm < 80) {
        advice.push('å¤šå¬èŠ‚æ‹å™¨ç»ƒä¹ ï¼Œå¢å¼ºèŠ‚å¥æ„Ÿ');
      }
      if (volume < 80) {
        advice.push('åŠ å¼ºæ°”æ¯è®­ç»ƒï¼Œæ”¹å–„éŸ³é‡æ§åˆ¶');
      }
      if (timbre < 80) {
        advice.push('ç»ƒä¹ å…±é¸£æŠ€å·§ï¼Œè®©éŸ³è‰²æ›´åŠ åœ†æ¶¦');
      }
      if (advice.length === 0) {
        advice.push('ç»§ç»­ä¿æŒï¼Œä½ çš„å£°éŸ³è¡¨ç°å¾ˆæ£’ï¼');
      }

      return advice;
    }

    // æ¸²æŸ“é¡µé¢
    function renderPage(data) {
      const score = data.score || 0;
      const level = getScoreLevel(score);
      const message = getPersonalizedMessage(score);
      const comparison = calculateComparison(score);
      const achievements = generateAchievements(data);
      const advice = getAdvice(data);

      // è®¾ç½®æ—¥æœŸ
      const date = new Date();
      document.getElementById('date').textContent = 
        `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;

      // è®¾ç½®åˆ†æ•°
      animateScore(score);
      document.getElementById('levelBadge').textContent = level;
      document.getElementById('message').textContent = message;
      document.getElementById('comparison').textContent = `è¶…è¿‡ ${comparison}% çš„ç”¨æˆ·`;

      // æ¸²æŸ“æŒ‡æ ‡
      const metricsList = document.getElementById('metricsList');
      const metrics = [
        { name: 'éŸ³å‡†', score: data.pitch || 0, icon: 'ğŸµ' },
        { name: 'èŠ‚å¥', score: data.rhythm || 0, icon: 'ğŸ¼' },
        { name: 'éŸ³é‡', score: data.volume || 0, icon: 'ğŸ”Š' },
        { name: 'éŸ³è‰²', score: data.timbre || 0, icon: 'ğŸ¤' }
      ];

      metricsList.innerHTML = metrics.map(metric => `
        <div class="metric-item">
          <div class="metric-header">
            <div class="metric-name">
              <span>${metric.icon}</span>
              <span>${metric.name}</span>
            </div>
            <div class="metric-score">${metric.score}åˆ†</div>
          </div>
          <div class="metric-bar">
            <div class="metric-fill" style="width: ${metric.score}%"></div>
          </div>
        </div>
      `).join('');

      // æ¸²æŸ“æˆå°±
      if (achievements.length > 0) {
        document.getElementById('achievementsSection').style.display = 'block';
        document.getElementById('achievementsList').innerHTML = achievements.map(achievement => `
          <div class="achievement-item">
            <div class="achievement-icon">${achievement.icon}</div>
            <div class="achievement-name">${achievement.name}</div>
          </div>
        `).join('');
      }

      // æ¸²æŸ“å»ºè®®
      document.getElementById('adviceList').innerHTML = advice.map(item => `
        <li class="advice-item">${item}</li>
      `).join('');

      // æ˜¾ç¤ºå†…å®¹
      document.getElementById('loading').style.display = 'none';
      document.getElementById('content').style.display = 'block';
    }

    // åˆ†æ•°åŠ¨ç”»
    function animateScore(finalScore) {
      let currentScore = 0;
      const increment = finalScore / 60;
      const timer = setInterval(() => {
        currentScore += increment;
        if (currentScore >= finalScore) {
          currentScore = finalScore;
          clearInterval(timer);
        }
        document.getElementById('scoreNumber').textContent = Math.round(currentScore);
        
        // æ›´æ–°è¿›åº¦ç¯ï¼ˆä½¿ç”¨SVG stroke-dashoffsetï¼‰
        const progress = currentScore / 100;
        const circumference = 2 * Math.PI * 82; // åŠå¾„82px
        const offset = circumference * (1 - progress);
        const progressCircle = document.getElementById('scoreProgressCircle');
        if (progressCircle) {
          progressCircle.style.strokeDashoffset = offset;
        }
      }, 20);
    }

    // å¤åˆ¶é“¾æ¥
    function copyLink() {
      const url = window.location.href;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(url).then(() => {
          alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        });
      } else {
        // é™çº§æ–¹æ¡ˆ
        const textarea = document.createElement('textarea');
        textarea.value = url;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      }
    }

    // åˆ†äº«åˆ°å¾®ä¿¡
    function shareToWechat() {
      const url = window.location.href;
      copyLink();
      alert('é“¾æ¥å·²å¤åˆ¶ï¼Œè¯·ç²˜è´´åˆ°å¾®ä¿¡ä¸­åˆ†äº«ç»™å¥½å‹');
    }

    // åˆå§‹åŒ–
    window.onload = function() {
      const data = getUrlParams();
      if (data) {
        renderPage(data);
      } else {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
      }
    };
  </script>
</body>
</html>

